<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unveiled</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;700&family=Inter:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Host+Grotesk:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="about-page">
    <div class="background-images" id="backgroundImages"></div>
    <header>
      <a href="index.html" class="subtitle">UNVEILED</a>
      <a href="about.html" class="subtitle">ABOUT</a>
    </header>

    <main>
      <section class="concept">
        <p class="large-text">
          Nel flusso continuo tra terra e acqua, ogni specie lascia un segno,
          una traccia, una presenza che contribuisce a scrivere una complessa
          mappa di coesistenze. <br />Unveiled è un'esplorazione visiva e
          sensibile della biodiversità che abita il corridoio fluviale del
          Marzenego, un paesaggio vivo e mutevole dove organismi, habitat e
          presenze umane si intrecciano. L'obiettivo è svelare la trama
          invisibile che collega ogni forma di vita lungo il fiume, restituendo
          una visione ecologica in cui ogni elemento è in relazione con gli
          altri.<br /><br />
        </p>

        <p class="medium-text">
          L’osservazione naturalistica tradizionale tende a isolare i soggetti
          dal loro contesto, come se potessero esistere separati dall’ambiente
          che li sostiene. In Unveiled, invece, le specie emergono come nodi di
          una rete ecologica complessa, in cui il fiume funge da asse connettivo
          tra frammenti di ambienti urbani, zone agricole e spazi naturali.
          Attraverso la clusterizzazione di migliaia di osservazioni raccolte
          tramite la piattaforma iNaturalist, viene ricostruita una geografia
          biologica che non si limita a rappresentare ciò che è visibile, ma che
          dà voce anche ai vuoti, alle lacune, alle assenze — segnali silenziosi
          di un ecosistema in trasformazione.
        </p>

        <p class="medium-text">
          Il Marzenego è un fiume che attraversa il paesaggio veneto
          intrecciando centri urbani, zone agricole e ambienti naturali
          residuali. Il suo corso racconta una trasformazione continua del
          territorio, dove l’intervento umano convive — non sempre armonicamente
          — con l’ecologia fluviale. A ogni tratto, il paesaggio cambia, e con
          esso cambiano anche le specie che lo abitano e che vengono osservate.
          Il Consorzio di Bonifica Acque Risorgive, responsabile della gestione
          del fiume, si impegna nella tutela e riqualificazione dell’ambiente
          fluviale, promuovendo un equilibrio tra funzione idraulica e valore
          ecologico. In questo contesto, Unveiled si inserisce come strumento di
          lettura sensibile del territorio, amplificando il valore delle
          osservazioni naturalistiche raccolte lungo il fiume.
          <br /><br /><br /><br />
        </p>
      </section>
    </main>

    <section class="river-map">
      <img src="marzenego2.png" alt="fiume" />
    </section>

    <div class="coordinates-container">
      <div class="coordinates">
        <span class="coord-a">45.6362 N</span>
        <span class="coord-b">11.9419 E</span>
        <span class="coord-c">45.4775 N</span>
        <span class="coord-d">12.3330 E</span>
      </div>
    </div>

    <section class="concept">
      <p class="large-text">
        <br /><br />
        Unveiled visualizza 2890 specie osservate entro 1 km dal corso del
        Marzenego, disposte in ordine longitudinale secondo la loro posizione
        lungo il fiume.<br /><br />
      </p>
      <p class="medium-text">
        Le specie sono raggruppate per classe tassonomica e ordinate in base al
        numero di osservazioni, restituendo un quadro stratificato della
        presenza biologica nel territorio. Le immagini naturalistiche e i nomi
        scientifici accompagnano l’esplorazione visiva, componendo un atlante
        vivente che racconta non solo chi abita questi luoghi, ma anche come ci
        abita — e in quale misura riesce a convivere con il paesaggio
        antropizzato che lo circonda.I dati di citizen science, forniti da
        cittadini, ricercatori e appassionati tramite iNaturalist, sono
        reinterpretati per costruire un’esperienza visiva che non mostra solo
        chi c’è, ma anche dove manca qualcosa, e come le presenze si
        distribuiscono nel territorio.
      </p>

      <p class="medium-text">
        Le specie osservate sono visualizzate come in un esploso longitudinale
        del fiume, in cui ogni punto d’osservazione è allineato spazialmente per
        far emergere connessioni, pattern e discontinuità ecologiche.<br />
        L’utente può esplorare dinamicamente l’evoluzione della biodiversità
        fluviale, osservare variazioni temporali e identificare regioni più
        ricche o fragili. Le immagini naturalistiche e i nomi scientifici
        accompagnano questa esplorazione, componendo un atlante vivente che
        racconta non solo chi abita questi luoghi, ma anche come ci abita — e in
        quale misura riesce a convivere con il paesaggio antropizzato che lo
        circonda.<br />Organismi comuni e presenze rare convivono in uno spazio
        consultabile, dove ogni nome diventa traccia di un’esistenza. È uno
        strumento per orientarsi nella complessità biologica del territorio, ma
        anche un invito a soffermarsi, osservare, scoprire.
      </p>
    </section>

    <section class="opacity-legend">
      <div class="legend-bar">
        <div class="label-side">
          <span class="label">↓ meno osservata</span>
        </div>
        <div class="opacity-points">
          <div class="point" style="opacity: 0.1"></div>
          <div class="point" style="opacity: 0.3"></div>
          <div class="point" style="opacity: 0.5"></div>
          <div class="point" style="opacity: 0.7"></div>
          <div class="point" style="opacity: 1"></div>
        </div>
        <div class="label-side">
          <span class="label">più osservata ↑ </span>
        </div>
      </div>
    </section>

    <main>
      <section class="classes-overview" id="classes-overview"></section>
    </main>

    <script>
      let currentlyOpenRow = null;

      fetch("marzenego.json")
        .then((response) => response.json())
        .then((data) => {
          const classes = {};
          const speciesImages = {};
          const speciesCounts = {};

          data.forEach((entry) => {
            const taxClass = entry.taxon_class_name || "Classe sconosciuta";
            const kingdom = entry.taxon_kingdom_name || "Regno sconosciuto";
            const species =
              entry.taxon_species_name ||
              entry.scientific_name ||
              "Specie sconosciuta";
            const imageUrl = entry.image_url || null;

            if (!classes[taxClass]) {
              classes[taxClass] = {
                kingdom: kingdom,
                species: new Set(),
              };
            }
            classes[taxClass].species.add(species);

            if (imageUrl) {
              speciesImages[species] = imageUrl;
            }

            speciesCounts[species] = (speciesCounts[species] || 0) + 1;
          });

          const maxCount = Math.max(...Object.values(speciesCounts));
          const minOpacity = 0.1;

          const container = document.getElementById("classes-overview");

          Object.entries(classes)
            .sort((a, b) => b[1].species.size - a[1].species.size)
            .forEach(([taxClass, classData]) => {
              const row = document.createElement("div");
              row.className = "class-row";

              const speciesList = Array.from(classData.species)
                .map((species) => {
                  const hasImage = speciesImages[species] ? "has-image" : "";
                  const imageStyle = speciesImages[species]
                    ? `--species-image: url('${speciesImages[species]}');`
                    : "";
                  const count = speciesCounts[species] || 1;
                  const opacity =
                    (count / maxCount) * (1 - minOpacity) + minOpacity;

                  return `<span class="species-name ${hasImage}" style="${imageStyle}">
                      <span class="species-label" style="opacity: ${opacity}">${species}</span>
                    </span>`;
                })
                .join(" ");

              row.innerHTML = `
                  <div class="class-header">
                    <div class="class-info">
                      <div class="kingdom-label">${classData.kingdom}</div>
                      <div class="class-name">${taxClass}</div>
                    </div>
                    <div class="species-count">${classData.species.size} specie</div>
                  </div>
                  <div class="species-list">
                    ${speciesList}
                  </div>
                `;

              row.addEventListener("click", function (e) {
                if (e.target.classList.contains("species-label")) return;

                const isExpanded = this.classList.contains("expanded");

                if (currentlyOpenRow && currentlyOpenRow !== this) {
                  currentlyOpenRow.classList.remove("expanded", "no-hover");
                  currentlyOpenRow
                    .querySelector(".species-list")
                    .classList.remove("visible");
                }

                this.classList.toggle("expanded");
                this.classList.toggle("no-hover");
                this.querySelector(".species-list").classList.toggle("visible");

                currentlyOpenRow = this.classList.contains("expanded")
                  ? this
                  : null;
              });

              container.appendChild(row);
            });
        })
        .catch((err) => console.error("Errore nel parsing JSON", err));

      let imagePool = [];
      let imageUrls = [];
      let activeImageCount = 0;
      const maxActiveImages = 60;
      const totalImageCount = 500;
      const minChangeInterval = 1500;
      const maxChangeInterval = 2000;

      function createDynamicBackground() {
        fetch("marzenego.json")
          .then((response) => response.json())
          .then((data) => {
            const bgContainer = document.getElementById("backgroundImages");

            // Estrai URL immagini
            imageUrls = data.reduce((acc, entry) => {
              if (entry.image_url) acc.push(entry.image_url);
              return acc;
            }, []);

            if (!imageUrls.length) return;

            // Crea pool immagini
            for (let i = 0; i < totalImageCount; i++) {
              const img = document.createElement("img");
              img.className = "bg-image hidden";
              img.src = imageUrls[Math.floor(Math.random() * imageUrls.length)];
              img.style.left = `${5 + Math.random() * 90}%`;
              img.style.top = `${5 + Math.random() * 90}%`;
              bgContainer.appendChild(img);
              imagePool.push(img);
            }

            // Mostra immagini iniziali con effetto graduale
            showInitialImagesGradually();

            // Avvia animazione con intervallo casuale
            startRandomInterval();
          })
          .catch(console.error);
      }

      function showInitialImagesGradually() {
        const initialCount = Math.min(maxActiveImages, imagePool.length);
        const delayBetweenImages = 500; // ms tra un'immagine e l'altra

        for (let i = 0; i < initialCount; i++) {
          setTimeout(() => {
            const img = imagePool[i];
            img.classList.remove("hidden");
            activeImageCount++;
          }, i * delayBetweenImages);
        }
      }

      function startRandomInterval() {
        const randomInterval =
          minChangeInterval +
          Math.random() * (maxChangeInterval - minChangeInterval);
        setTimeout(() => {
          manageImagePool();
          startRandomInterval();
        }, randomInterval);
      }

      function showRandomImage() {
        if (activeImageCount >= maxActiveImages) return;

        const hiddenImages = imagePool.filter((img) =>
          img.classList.contains("hidden")
        );
        if (!hiddenImages.length) return;

        const img =
          hiddenImages[Math.floor(Math.random() * hiddenImages.length)];

        // Aggiorna posizione (80% chance) e immagine (50% chance)
        if (Math.random() > 0.2) {
          img.style.left = `${5 + Math.random() * 90}%`;
          img.style.top = `${5 + Math.random() * 90}%`;
        }
        if (Math.random() > 0.5) {
          img.src = imageUrls[Math.floor(Math.random() * imageUrls.length)];
        }

        img.classList.remove("hidden");
        activeImageCount++;
      }

      function hideRandomImage() {
        const visibleImages = imagePool.filter(
          (img) => !img.classList.contains("hidden")
        );
        if (!visibleImages.length) return;

        const img =
          visibleImages[Math.floor(Math.random() * visibleImages.length)];
        img.classList.add("hidden");
        activeImageCount--;
      }

      function manageImagePool() {
        // Numero casuale di cambi (1-3)
        const changes = 1 + Math.floor(Math.random() * 3);

        for (let i = 0; i < changes; i++) {
          // 60% chance di nascondere un'immagine
          if (activeImageCount > maxActiveImages * 0.4 && Math.random() > 0.4) {
            hideRandomImage();
          }

          // 70% chance di mostrare un'immagine
          if (activeImageCount < maxActiveImages && Math.random() > 0.3) {
            showRandomImage();
          }
        }
      }

      document.addEventListener("DOMContentLoaded", createDynamicBackground);
    </script>

    <footer class="site-footer">
      <div class="footer-columns">
        <div class="footer-col footer-project">
          <div class="footer-title">Unveiled – Atlante vivo del Marzenego</div>
          <div class="footer-dataset">
            Il progetto si basa su dati raccolti attraverso la piattaforma di
            citizen science iNaturalist, nel periodo compreso tra il 2004 e
            marzo 2025.
          </div>
        </div>
        <div class="footer-col footer-lab">
          <div class="footer-lab-title">Information Design Lab</div>
          <div class="footer-lab-info">
            Corso di laurea Magistrale in Interaction &amp; Experience Design<br />
            Università della Repubblica di San Marino<br />
            Con la supervisione di Giorgio Uboldi, Marco Luitprandi<br />
            In collaborazione con Osservatorio Citizen Science, ISPRA, Consorzio
            di Bonifica Acque Risorgive
            <br /><br />
            <span style="font-size: 1.1em; opacity: 0.7">&copy; 2025</span>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>
